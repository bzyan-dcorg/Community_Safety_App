Metadata-Version: 2.4
Name: community-safety-backend
Version: 0.1.0
Summary: Community Safety backend application
Requires-Python: >=3.10
Description-Content-Type: text/markdown
Requires-Dist: fastapi
Requires-Dist: uvicorn
Requires-Dist: sqlalchemy
Requires-Dist: pydantic
Requires-Dist: pydantic-settings
Requires-Dist: python-multipart

# RUN

cd backend
python -m venv venv
source venv/bin/activate  # Windows - venv\\Scripts\\activate
pip install -r requirements.txt  # run inside backend/ so the editable install succeeds
uvicorn backend.main:app --reload

# Troubleshooting
- If your environment blocks downloads from PyPI, add `--no-build-isolation` to the `pip install` command so it can reuse the
  already-installed build tooling.
- If you prefer not to perform the editable install, you can run `uvicorn main:app --reload` after activating the virtual
  environment.

## Sensitive role approvals

1. Run `python -m backend.scripts.bootstrap_admin --email admin@example.com --password <pwd>` to create the first `admin` reviewer.
2. When `/auth/register`, `/auth/login`, or `/auth/oauth` receives `staff` / `reporter` / `officer`, the API stores a pending record in `role_requests` and keeps the user as a resident until approval.
3. Reviewers (admin/officer) can call:
   - `GET /role-requests/?status_filter=pending` to retrieve the queue.
   - `POST /role-requests/{id}/decision` with `{"action":"approve"|"deny","notes":"..."}` (plus optional `role`) to approve or deny. Approved requests automatically elevate the user role.

## Database maintenance

- Existing SQLite files from older commits might miss the latest columns. Run `python -m backend.scripts.upgrade_sqlite` anytime you pull new migrations to apply the lightweight `ALTER TABLE` patches in-place.
- To start fresh, delete `community.db` (from the repository root) before launching `uvicorn`; the ORM will re-create the tables automatically.

## Sample data

Need quick demo data for the dashboards or Expo screen? Seed a demo user and three incidents:

```bash
python -m backend.scripts.seed_sample_data
```

The script is idempotentâ€”it skips rows that already exist.
